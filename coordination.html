<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Coordination - CourtOrder</title>
    <link rel="stylesheet" href="src/style.css">
    <link rel="stylesheet" href="src/coordination-style.css">
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar">
        <div class="nav-left">
            <a href="index.html">
                <img src="Images/Court Gavel.png" alt="Gavel" style="height:50px; vertical-align:middle; margin-right:12px;">
            </a>
            CourtOrder
        </div>
        <div class="nav-links">
            <a href="https://en.wikipedia.org/wiki/Robert%27s_Rules_of_Order" target="_blank">About</a>
            <a href="meetings.html">Meetings</a>
            <a href="coordination.html">Coordination</a>
        </div>
        <button class="sign-in-btn" id="auth-btn" onclick="handleAuthButton()">Sign In</button>
    </nav>

    <!-- Main Content -->
    <div class="coordination-container">
        <h2>Meeting Coordination</h2>
        
        <!-- Session Status -->
        <div class="session-status">
            <h3>Session Status</h3>
            <div id="session-info">
                <p>No active session</p>
                <button id="start-session-btn" class="primary-btn">Start New Session</button>
            </div>
        </div>

        <!-- New Motion Form -->
        <div class="motion-form" id="motion-form" style="display: none;">
            <h3>Propose New Motion</h3>
            <input type="text" id="motion-title" placeholder="Motion Title">
            <textarea id="motion-description" placeholder="Motion Description" rows="3"></textarea>
            <div class="form-buttons">
                <button id="submit-motion-btn" class="primary-btn">Submit Motion</button>
                <button id="cancel-motion-btn" class="secondary-btn">Cancel</button>
            </div>
        </div>

        <!-- Active Motions -->
        <div class="active-motions">
            <h3>Active Motions</h3>
            <div id="motions-container">
                <p class="no-motions">No active motions</p>
            </div>
        </div>

        <!-- Voting History -->
        <div class="voting-history">
            <h3>Voting History</h3>
            <div id="history-container">
                <p class="no-history">No voting history</p>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="src/router.js"></script>
    <script src="src/data-manager.js"></script>
    <script src="src/coordination.js"></script>
    <script>
        // Authentication check and button handler
        function checkAuth() {
            const authData = localStorage.getItem('courtorder_auth');
            if (!authData) {
                window.location.href = 'login.html';
                return false;
            }
            
            try {
                const auth = JSON.parse(authData);
                if (!auth.isLoggedIn) {
                    window.location.href = 'login.html';
                    return false;
                }
                return true;
            } catch (e) {
                localStorage.removeItem('courtorder_auth');
                window.location.href = 'login.html';
                return false;
            }
        }

        function handleAuthButton() {
            const authData = localStorage.getItem('courtorder_auth');
            if (authData) {
                try {
                    const auth = JSON.parse(authData);
                    if (auth.isLoggedIn) {
                        if (confirm('Do you want to sign out?')) {
                            localStorage.removeItem('courtorder_auth');
                            window.location.href = 'index.html';
                        }
                        return;
                    }
                } catch (e) {
                    localStorage.removeItem('courtorder_auth');
                }
            }
            window.location.href = 'login.html';
        }

        function updateAuthButton() {
            const authBtn = document.getElementById('auth-btn');
            const authData = localStorage.getItem('courtorder_auth');
            
            if (authData) {
                try {
                    const auth = JSON.parse(authData);
                    if (auth.isLoggedIn) {
                        authBtn.textContent = `Sign Out (${auth.username})`;
                        return;
                    }
                } catch (e) {
                    localStorage.removeItem('courtorder_auth');
                }
            }
            authBtn.textContent = 'Sign In';
        }

        // Check authentication on page load
        document.addEventListener('DOMContentLoaded', () => {
            if (checkAuth()) {
                updateAuthButton();
            }
        });
    </script>
</body>
</html>
